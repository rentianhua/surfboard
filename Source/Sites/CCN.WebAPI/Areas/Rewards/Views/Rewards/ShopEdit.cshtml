
@{
    ViewBag.Title = "ShopEdit";
    Layout = "~/Views/Shared/_LayoutEmpty.cshtml";
}



<script type="text/javascript">

    var id = "@ViewBag.innerid";

    $(function() {
        InitProv();
        Init();
    });

    //初始化省份
    function InitProv() {
        $("#selectprov").empty();
        $("#selectprov").append("<option value='0'>请选择</option>");

        $.ajax({
            url: "/api/Base/GetProvList",
            type: 'get',
            datatype: 'application/json',
            async: false,
            success: function(data) {
                data = data.errmsg;
                $.each(data, function(k, v) {
                    $("#selectprov").append("<option value='" + v.Innerid + "'>" + v.ProvName + "</option>");
                });

                var jsid = 11;
                $("#selectprov").selectVal(jsid);
                InitCity(jsid);
            }
        });
    }

    //初始化城市
    function InitCity(provid) {
        $("#selectcity").empty();
        $("#selectcity").append("<option value='0'>请选择</option>");

        $.ajax({
            url: "/api/Base/GetCityList/?provid=" + provid,
            type: 'get',
            datatype: 'application/json',
            async: false,
            success: function(data) {
                data = data.errmsg;
                $.each(data, function(k, v) {
                    $("#selectcity").append("<option value='" + v.Innerid + "'>" + v.CityName + "</option>");
                });
                $("#selectcity").selectVal(125);
            }
        });
    }

    function Init() {

        if (id === "") {
            return;
        }

        $.ajax({
            url: '/api/Rewards/GetShopById?innerid=' + id,
            type: 'get',
            datatype: 'application/json',
            async: false,
            success: function(data) {

                if (data.errcode !== 0) {
                    alert("获取数据异常！");
                }
                var obj = data.errmsg;
                $("#shopname").val(obj.Shopname);
                $("#loginname").val(obj.Loginname).prop("disabled", true);
                $("#password").val(obj.Password).prop("disabled", true);
                $("#telephone").val(obj.Telephone);                
                $("#email").val(obj.Email);
                $("#area").val(obj.Area);
                $("#qq").val(obj.QQ);
                $("#signature").val(obj.Signature);

                $("#selectprov").selectVal(obj.Provid);

                InitCity(obj.Provid);

                $("#selectcity").selectVal(obj.Cityid);
            }
        });
    }

    function Submit() {

        var json = {
            Shopname: $("#shopname").val(),
            Shopcode: $("#shopcode").val(),
            Password: $("#password").val(),
            Telephone: $("#telephone").val(),
            Email: $("#email").val(),
            provid: $("#selectprov").val(),
            cityid: $("#selectcity").val(),
            Area: $("#area").val(),
            Signature: $("#signature").val(),
            QQ: $("#qq").val()
        };

        if (json.Shopname === "") {
            alert('请输入标题');
            return false;
        }

        if (json.Shopcode === "") {
            alert('请输入登录名');
            return false;
        }

        if (id === "") {

            if (json.Password === "") {
                alert('请输入密码');
                return false;
            }

            $.post("/api/Rewards/AddShop", json, function(result) {
                var str = result.errcode === 0 ? "添加成功" : "添加失败";
                alert(str);
                ToList();
            });
        } else {
            json.Password = "";  //修改时不能修改密码
            json.Innerid = id;
            $.ajax({
                url: '/api/Rewards/UpdateShop',
                type: 'put',
                datatype: 'application/json',
                data: json,
                async: false,
                success: function(result) {
                    var str = result.errcode === 0 ? "更新成功" : "更新失败";
                    alert(str);
                    ToList();
                }
            });
        }
        return false;
    }

    function ToList() {
        location.href = "/rewards/rewards/shoplist";
    }

</script>
<div>
    <div style="font-size:18px;font-weight:bold;text-align:center">礼券编辑</div>
    <table id="coupon" class="gridtable">
        <tbody>
            <tr>
                <td>商户名称<label class="required">*</label></td>
                <td>
                    <input type="text" id="shopname"  placeholder="商户名称"/>
                </td>
            </tr>
            <tr>
                <td>商户编号<label class="required">*</label></td>
                <td>
                    <input type="text" id="shopcode"  placeholder="商户编号"/>
                </td>
            </tr>
        <tr>
            <td>密码<label class="required">*</label></td>
            <td id="">
                <input type="password" id="password"  placeholder="密码"/>
            </td>
        </tr>
            <tr>
                <td>联系电话</td>
                <td>
                    <input type="text" id="telephone"  placeholder="联系电话"/>
                </td>
            </tr>
        <tr>
            <td>Email</td>
            <td>
                <input type="text" id="email"  placeholder="Email"/>
            </td>
        </tr>
        <tr>
            <td>所在地</td>
            <td>
                <select id="selectprov" onchange="InitCity(this.options[this.options.selectedIndex].value)">
                    <option value="0">请选择</option>
                </select>
                <select id="selectcity">
                    <option value="0">请选择</option>
                </select>
                <input type="text" id="area" placeholder="区" />
            </td>
        </tr>
            <tr>
                <td>QQ</td>
                <td>
                    <input type="text" id="qq"  placeholder="QQ"/>
                </td>
            </tr>
        <tr>
            <td>个人签名</td>
            <td>
                <textarea id="signature" maxlength="200" rows="5" cols="150" placeholder="个人签名"></textarea>
            </td>
        </tr>
            
            <tr>
                <td></td>
                <td>
                    <input type="submit" value="保存" onclick="Submit()" />
                    <input type="button" value="返回" onclick="ToList();" />
                </td>
            </tr>
        </tbody>
    </table>
</div>

